<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.dasi.admin.memberInfo.dao.MemberMapper">

    <resultMap id="MemberResultMap" type="com.project.dasi.admin.memberInfo.dto.MemberDTO">
        <id property="userCode" column="USER_CODE"/>
        <result property="userId" column="USER_ID"/>
        <result property="userPwd" column="USER_PWD"/>
        <result property="userName" column="USER_NAME"/>
        <result property="birthDate" column="BIRTH_DATE"/>
        <result property="email" column="BIRTH_DATE"/>
        <result property="tel" column="TEL"/>
        <result property="gender" column="GENDER"/>
        <result property="marketingStatus" column="MARKETING_STATUS"/>
        <result property="joinDate" column="JOIN_DATE"/>
        <result property="withdrawStatus" column="WITHDRAW_STATUS"/>
        <result property="withdrawDate" column="WITHDRAW_DATE"/>

    </resultMap>

    <sql id="default">
        SELECT USER_CODE, USER_ID, USER_PWD, USER_NAME, BIRTH_DATE,
        EMAIL, TEL, GENDER, MARKETING_STATUS, JOIN_DATE, WITHDRAW_STATUS, WITHDRAW_DATE
        FROM USER_INFO
    </sql>

    <sql id="search">
        <if test="condition == 'userCode'">
            WHERE USER_CODE LIKE CONCAT('%',#{keyword},'%')
        </if>
        <if test="condition == 'userId'">
            WHERE USER_ID LIKE CONCAT('%',#{keyword},'%')
        </if>
        <if test="condition == 'userName'">
            WHERE USER_NAME LIKE CONCAT('%',#{keyword},'%')
        </if>
    </sql>

    <select id="getMemberList" resultMap="MemberResultMap">
        <include refid="default"></include> limit 0, 10
    </select>

    <insert id="registMember" parameterType="com.project.dasi.admin.memberInfo.dto.MemberDTO">
        INSERT INTO USER_INFO (
        USER_CODE, USER_ID, USER_PWD, USER_NAME, BIRTH_DATE,
        EMAIL, TEL, GENDER, MARKETING_STATUS, JOIN_DATE, WITHDRAW_STATUS, WITHDRAW_DATE
        )
        VALUES (
        #{ userCode }
        ,#{ userId }
        ,#{ userPwd }
        ,#{ userName }
        ,#{ birthDate }
        ,#{ email }
        ,#{ tel }
        ,#{ gender }
        ,#{ marketingStatus }
        ,#{ joinDate }
        ,#{ withdrawStatus }
        ,#{ withdrawDate }
        )
    </insert>


    <select id="getListWithPaging" resultType="com.project.dasi.admin.memberInfo.dto.MemberDTO">
        SELECT *
        FROM USER_INFO
        WHERE
        <if test="type != null and keyword != null">
            <trim prefix="(" suffix=") AND" prefixOverrides="OR">
                <foreach item="type" collection="typeArr">
                    <trim prefix="OR">
                        <choose>
                            <when test="type=='A'.toString()">
                                (TITLE LIKE '%'||#{keyword}||'%')
                            </when>
                            <when test="type=='B'.toString()">
                                (CONTENT LIKE '%'||#{keyword}||'%')
                            </when>
                            <when test="type=='C'.toString()">
                                (WRITER LIKE '%'||#{keyword}||'%')
                            </when>
                        </choose>
                    </trim>
                </foreach>
            </trim>
        </if>
        <![CDATA[
                ROWNUM <= #{pageNum} * #{amount})
            WHERE RN > (#{pageNum} - 1) * #{amount}
        ]]>
    </select>

    <select id="getTotalCount" resultType="int">
        SELECT COUNT(*) FROM USER_INFO WHERE USER_CODE IS NOT NULL
    </select>


</mapper>
